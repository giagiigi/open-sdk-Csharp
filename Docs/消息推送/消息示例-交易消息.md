## 交易消息

### 订单状态事件 TRADE_ORDER_STATE
| 订单状态事件 | status 值 |
| --- | --- |
| 等待买家付款 | WAIT_BUYER_PAY |
| 等待卖家发货,即:买家已付款 | WAIT_SELLER_SEND_GOODS |
| 等待确认，买家已付款，等待商家确认（拼团/外卖） | WAIT_CONFIRM |
| 等待买家确认收货,即:卖家已发货 | WAIT_BUYER_CONFIRM_GOODS |
| 交易成功 | TRADE_SUCCESS |
| 交易关闭 | TRADE_CLOSED |

#### 消息结构示例
``` json
{
    "client_id":"6cd25b3f99727975b5",
    "id":"E20170807181905034500002",
    "kdt_id":63077,
    "kdt_name":"Qi码运动馆",
    "mode":1,
    "msg":"%7B%22update_time%22:%222017-08-07%2018:19:05%22,%22payment%22:%2211.00%22,%22tid%22:%22E20170807181905034500002%22,%22status%22:%22TRADE_CLOSED%22%7D",
    "sendCount":0,
    "sign":"5c15274ca4c079197c89154f44b20307",
    "status":"TRADE_CLOSED",
    "test":false,
    "type":"TRADE_ORDER_STATE",
    "version":1502101273
}
```

#### msg参数字段含义
| 字段名 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| tid | string | 订单号 | E20171234567890123456789 |
| status | String | 订单状态 | WAIT_BUYER_PAY(等待买家付款)；WAIT_SELLER_SEND_GOODS(等待卖家发货,即:买家已付款)；WAIT_CONFIRM (等待确认，买家已付款，等待商家确认。包括 拼团订单的待成团，外卖订单的待接单)；WAIT_BUYER_CONFIRM_GOODS(等待买家确认收货,即:卖家已发货)；TRADE_SUCCESS(交易成功)；TRADE_CLOSED(交易关闭) |
| payment | number | 订单金额（单位：元） | 0.01 |
| update_time | string | 更新时间 | 2017-05-19 10:00:00|


### 退款事件 TRADE_ORDER_REFUND

#### 消息结构示例
``` json
{
    "client_id":"6cd25b3f99727975b5",
    "id":"E20170807211747070800001",
    "kdt_id":63077,
    "kdt_name":"Qi码运动馆",
    "mode":1,
    "msg":"%7B%22update_time%22:%222017-08-07%2021:18:48%22,%22refund_type%22:%22REFUND_ONLY%22,%22refunded_fee%22:%220.01%22,%22refund_reason%22:%22RETURNSNOT_BUYWRONG%22,%22oid%22:1396889105670864897,%22refund_id%22:%22W1708072118487597%22,%22refund_state%22:%22SAFE_NEW%22,%22tid%22:%22E20170807211747070800001%22%7D",
    "sendCount":0,
    "sign":"e48bb28001edcdf6dfef56ce3a4d8b71",
    "test":false,
    "type":"TRADE_ORDER_REFUND",
    "version":1502111928
}
```

#### msg参数字段含义
| 字段名 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| tid | string | 订单号 | E20171234567890123456789 |
| status | String | 订单状态 | WAIT_BUYER_PAY(等待买家付款)；WAIT_SELLER_SEND_GOODS(等待卖家发货,即:买家已付款)；WAIT_CONFIRM (等待确认，买家已付款，等待商家确认。包括 拼团订单的待成团，外卖订单的待接单)；WAIT_BUYER_CONFIRM_GOODS(等待买家确认收货,即:卖家已发货)；TRADE_SUCCESS(交易成功)；TRADE_CLOSED(交易关闭) |
| oid | number | 交易明细编号 | 123455532 |
| refund_id | string | 退款id| W32132132122321 |
| refund_state | string | 退款状态 | SAFE_NEW（买家发起）；SAFE_HANDLED（被拒绝后再次发起）；SAFE_REJECT（卖家拒绝）；SAFE_INVOLVED（客服介入）；SAFE_ACCEPT（卖家接受）；SAFE_SEND（买家发货）；SAFE_NO_RECEIVE（卖家没有收到货）；SAFE_CLOSE（维权关闭）；SAFE_FINISHED（维权结束）|
| payment | number | 订单金额| 0.01|
| update_time | string | 更新时间 | 2017-05-19 10:00:00|
| refunded_fee | number | 退款金额 | 0.01 |
| refund_type | string | 退款类型 | REFUND_ONLY（仅退款）；REFUND_AND_RETURN（退货退款） |
| refund_reason | string | 退款原因 | 仅退款，未收到货申请原因：COMMON_CONSENSUS（买/卖双方协商一致）；COMMON_BUYWRONG（买错/多买/不想要）；COMMON_QUALITY（商品质量问题）；COMMON_NOTRECEIVE（未收到货品）；COMMON_OTHER（其他）；REFUND_QUALITY（质量问题）；REFUND_BUYWRONG（拍错/多拍/不喜欢）；REFUND_INCONFORMITY（商品描述不符）；REFUND_FAKE（假货）；REFUND_SENDWRONG（商家发错货）；REFUND_GOODSLESS（商品破损/少件）；REFUND_OTHER（其他）；仅退款，已收到货申请原因：RETURNSNOT_BUYWRONG（多买/买错/不想要）；RETURNSNOT_NULLEXPRESS（快递无记录）；RETURNSNOT_GOODSLESS（少货/空包裹）；RETURNSNOT_NOTEXPRESS_ONTIME（未按约定时间发货）；RETURNSNOT_NOTRECEIVE（快递一直未送达）；RETURNSNOT_OTHER（快递一直未送达）；退货退款，申请原因：RETURNS_GOODSLESS（商品破损/少件）；RETURNS_SENDWRONG（商家发错货）；RETURNS_INCONFORMITY（商品描述不符）；RETURNS_BUYWRONG（拍错/多拍/不喜欢）；RETURNS_QUALITY（质量问题）；RETURNS_FAKE（假货）；RETURNS_OTHER（其他） |

#### 物流事件 TRADE_ORDER_EXPRESS

#### 消息结构示例
``` json
{
    "client_id":"6cd25b3f99727975b5",
    "id":"E20170807181402034500001",
    "kdt_id":63077,
    "kdt_name":"Qi码运动馆",
    "mode":1,
    "msg":"%7B%22express_id%22:7,%22update_time%22:%222017-07-08%2021:33:24%22,%22express_no%22:%22888888888%22,%22oids%22:%2217997097%22,%22tid%22:%22E20170807181402034500001%22%7D",
    "sendCount":0,
    "sign":"2e535f22db0feafa7d05bef0b8c2eea9",
    "test":false,
    "type":"TRADE_ORDER_EXPRESS",
    "version":1502112804
}
```

#### msg参数字段含义
| 字段名 | 类型 | 描述 | 示例 |
| --- | --- | --- | --- |
| tid | string | 订单号 | E20171234567890123456789 |
| oids | number | 交易明细编号 | 123455532 |
| express_id | number | 物流类型 | 4 |
| express_no | string | 物流单号 | 1212312312312 |
| update_time | string | 更新时间 | 2017-05-19 10:00:00 |

### 交易消息V1 TRADE
2017年12月31日将停止推送，请尽早更换使用上述新版的消息

#### 消息结构示例
``` json
{
          "mode": 0,
          "msg": "%7B%22trade%22:%7B%22num%22:2,%22goods_kind%22:2,%22num_iid%22:%22293545836%22,%22price%22:%22818.00%22,%22pic_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FgrQmOizM8A08xysgUvetnedZsb8.jpg%22,%22pic_thumb_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FgrQmOizM8A08xysgUvetnedZsb8.jpg%3FimageView2/2/w/200/h/0/q/75/format/jpg%22,%22title%22:%22%E5%8A%A0%E5%BC%BA%E5%9E%8B%E7%BE%8A%E8%83%9A%E8%83%8E%E7%B4%A0%E5%86%BB%E5%B9%B2%E7%B2%892%E7%9B%92%EF%BC%885%E5%91%A8%E5%B9%B4%E7%BA%AA%E5%BF%B5%E7%89%88%EF%BC%89%22,%22type%22:%22FIXED%22,%22discount_fee%22:%220.00%22,%22status%22:%22WAIT_SELLER_SEND_GOODS%22,%22status_str%22:%22%E5%BE%85%E5%8F%91%E8%B4%A7%22,%22refund_state%22:%22NO_REFUND%22,%22shipping_type%22:%22express%22,%22post_fee%22:%220.00%22,%22total_fee%22:%22818.00%22,%22refunded_fee%22:%220.00%22,%22payment%22:%22818.00%22,%22created%22:%222016-08-18%2000:14:58%22,%22update_time%22:%222016-08-18%2000:15:08%22,%22pay_time%22:%222016-08-18%2000:15:08%22,%22pay_type%22:%22WEIXIN_DAIXIAO%22,%22consign_time%22:%22%22,%22sign_time%22:%22%22,%22buyer_area%22:%22%E6%B1%9F%E8%8B%8F%E7%9C%81%E9%95%87%E6%B1%9F%E5%B8%82%22,%22seller_flag%22:0,%22buyer_message%22:%22%22,%22orders%22:[%7B%22oid%22:18240980,%22outer_sku_id%22:%22%22,%22outer_item_id%22:%220016081001%22,%22title%22:%22%E5%8A%A0%E5%BC%BA%E5%9E%8B%E7%BE%8A%E8%83%9A%E8%83%8E%E7%B4%A0%E5%86%BB%E5%B9%B2%E7%B2%892%E7%9B%92%EF%BC%885%E5%91%A8%E5%B9%B4%E7%BA%AA%E5%BF%B5%E7%89%88%EF%BC%89%22,%22seller_nick%22:%22%E9%9D%93%E5%A6%86%E9%A2%91%E9%81%93%22,%22fenxiao_price%22:%220.00%22,%22fenxiao_payment%22:%220.00%22,%22price%22:%22818.00%22,%22total_fee%22:%22818.00%22,%22payment%22:%22818.00%22,%22discount_fee%22:%220.00%22,%22sku_id%22:0,%22sku_unique_code%22:%22%22,%22sku_properties_name%22:%22%22,%22pic_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FgrQmOizM8A08xysgUvetnedZsb8.jpg%22,%22pic_thumb_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FgrQmOizM8A08xysgUvetnedZsb8.jpg%3FimageView2/2/w/200/h/0/q/75/format/jpg%22,%22item_type%22:0,%22buyer_messages%22:[],%22order_promotion_details%22:[],%22state_str%22:%22%E5%BE%85%E5%8F%91%E8%B4%A7%22,%22allow_send%22:1,%22is_send%22:0,%22item_refund_state%22:%22%22,%22is_virtual%22:0,%22num_iid%22:%22293545836%22,%22num%22:%221%22%7D,%7B%22oid%22:18240981,%22outer_sku_id%22:%22%22,%22outer_item_id%22:%221116050301%22,%22title%22:%22%E5%8A%A0%E5%BC%BA%E5%9E%8B%E7%BE%8A%E8%83%9A%E8%83%8E%E7%B4%A0%E5%86%BB%E5%B9%B2%E7%B2%8912%E4%BB%B6%E5%A5%97%E7%9B%92%22,%22seller_nick%22:%22%E9%9D%93%E5%A6%86%E9%A2%91%E9%81%93%22,%22fenxiao_price%22:%220.00%22,%22fenxiao_payment%22:%220.00%22,%22price%22:%22700.00%22,%22total_fee%22:%22700.00%22,%22payment%22:%220.00%22,%22discount_fee%22:%220.00%22,%22sku_id%22:0,%22sku_unique_code%22:%22%22,%22sku_properties_name%22:%22%22,%22pic_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FmhOA0LhsW_tOXsSAUQ-gUeqvwRA.jpg%22,%22pic_thumb_path%22:%22https://img.yzcdn.cn/upload_files/2016/08/10/FmhOA0LhsW_tOXsSAUQ-gUeqvwRA.jpg%3FimageView2/2/w/200/h/0/q/75/format/jpg%22,%22item_type%22:0,%22buyer_messages%22:[],%22order_promotion_details%22:[],%22state_str%22:%22%E5%BE%85%E5%8F%91%E8%B4%A7%22,%22allow_send%22:1,%22is_send%22:0,%22item_refund_state%22:%22%22,%22is_virtual%22:0,%22num_iid%22:%22293233753%22,%22num%22:%221%22%7D],%22fetch_detail%22:null,%22coupon_details%22:[],%22promotion_details%22:[],%22adjust_fee%22:%7B%22change%22:%220.00%22,%22pay_change%22:%220.00%22,%22post_change%22:%220.00%22%7D,%22sub_trades%22:[],%22weixin_user_id%22:%220%22,%22button_list%22:[%7B%22tool_icon%22:%22http://imgqn.koudaitong.com/upload_files/2015/08/28/FpFY_MeJXzLCA3lwIV6br6qUbClv.png%22,%22tool_title%22:%22%E5%8F%91%E8%B4%A7%22,%22tool_value%22:%22%22,%22tool_type%22:%22goto_native:trade_send_goods%22,%22tool_parameter%22:%22%7B%7D%22,%22new_sign%22:%220%22,%22create_time%22:%22%22%7D,%7B%22tool_icon%22:%22http://imgqn.koudaitong.com/upload_files/2015/08/28/FpO1UIXyOEZO026tWIgUOm9uZnT2.png%22,%22tool_title%22:%22%E5%A4%87%E6%B3%A8%22,%22tool_value%22:%22%22,%22tool_type%22:%22goto_native:trade_memo%22,%22tool_parameter%22:%22%7B%7D%22,%22new_sign%22:%220%22,%22create_time%22:%22%22%7D],%22feedback_num%22:0,%22trade_memo%22:%22%22,%22fans_info%22:%7B%22fans_nickname%22:%22%E9%A3%8E%E7%81%B5%22,%22fans_id%22:%22323484938%22,%22buyer_id%22:%227772765%22,%22fans_type%22:%229%22%7D,%22buy_way_str%22:%22%22,%22pf_buy_way_str%22:%22%E8%BF%90%E8%B4%B9%E5%88%B0%E4%BB%98%22,%22send_num%22:0,%22user_id%22:%227772765%22,%22kind%22:2,%22relation_type%22:%22%22,%22relations%22:[],%22out_trade_no%22:[],%22group_no%22:%22%22,%22outer_user_id%22:0,%22shop_id%22:%220%22,%22points_price%22:0,%22buyer_nick%22:%22%E9%A3%8E%E7%81%B5%22,%22tid%22:%22E20160818001458060573844%22,%22buyer_type%22:%229%22,%22buyer_id%22:%22323484938%22,%22receiver_city%22:%22%E9%95%87%E6%B1%9F%E5%B8%82%22,%22receiver_district%22:%22%E5%85%B6%E5%AE%83%E5%8C%BA%22,%22receiver_name%22:%22%E5%8D%A2%E7%90%AA%22,%22receiver_state%22:%22%E6%B1%9F%E8%8B%8F%E7%9C%81%22,%22receiver_address%22:%22%E6%89%AC%E4%B8%AD%E5%B8%82%E4%B8%89%E8%8C%85%E9%95%87%E7%94%B0%E5%9B%AD%E5%B0%8F%E5%8C%BA88%E5%8F%B7%22,%22receiver_zip%22:%22212200%22,%22receiver_mobile%22:%2218888888888%22,%22feedback%22:0,%22outer_tid%22:%224000092001201608181596388907%22%7D%7D",
          "kdt_id": 172938,
          "test": false,
          "sign": "dd4f2be7d3ffa5f877aca36028689a47",
          "id": "E20160818001458060573844",
          "sendCount": 0,
          "type": "TRADE",
          "app_id": "hello",
          "version": 1471450508,
          "status": "WAIT_SELLER_SEND_GOODS"
}
```
#### msg参数字段含义
请参考：[交易对象](http://open.youzan.com/apilist/structparam?struct=TradeDetail)